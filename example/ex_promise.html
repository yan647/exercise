<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div>来源：https://juejin.im/post/5b6e5cbf51882519ad61b67e#heading-0</div>
</body>
<script>
    /***
     * 标准的promise
     */
    let promise = new Promise(function (resolve, reject) {
        console.log("我是会被立即执行的");
        resolve();
        reject();//不会被执行
    });
    promise.then(() => {
        console.log("success");
    }, () => {
        console.log("fail");
    });
    console.log("other");

    /***
     * 自己实现一个Promise
     *
     */
    function MyPromise(executor) {
        this.value = undefined;
        this.error = undefined;
        this.state = "pending";
        this.onResolvedCallbacks = [];
        this.onRejectCallbacks = [];

        let resolve = (value) => {
                if (this.state === "pending") {
                    this.value = value;
                    this.state = "resolve";
                    this.onResolvedCallbacks.forEach(fn => fn());
                }
            },
            reject = (error) => {
                if (this.state === "pending") {
                    this.error = error;
                    this.state = "reject";
                    this.onRejectCallbacks.forEach(fn => fn());
                }
            };

        try {
            executor(resolve, reject);
        } catch (error) {
            reject(error);
        }
    }

    MyPromise.prototype.then = (onFulfilled, onRejected) => {
        if (this.state === "resolve") {
            onFulfilled(this.value);
        } else if (this.state === "reject") {
            onRejected(this.error);
        }

        if (this.state === "pending") {
            this.onResolvedCallbacks.push(() => {
                onFulfilled(this.value);
            });
            this.onResolvedCallbacks.push(() => {
                onRejected(this.error);
            })
        }
    };
</script>
</html>
